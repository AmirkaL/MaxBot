<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ—à–ö–µ—à - –°–¥–∞–≤–∞–π –º—É—Å–æ—Ä, –ø–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ yandex-maps-loader.js -->
    {% if yandex_maps_api_key %}
    <script>window.YANDEX_MAPS_API_KEY = '{{ yandex_maps_api_key }}';</script>
    {% endif %}
    <script src="/static/js/yandex-maps-loader.js"></script>
</head>
<body>
    <div id="app">
        <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="loading" class="loading-screen">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-screen" class="screen hidden">
            <!-- –®–∞–ø–∫–∞ -->
            <header class="header">
                <div class="header-content">
                    <div class="header-left">
                        <div class="logo-compact">‚ôªÔ∏è</div>
                        <div class="header-title">
                            <span class="logo-text">–¢—Ä–µ—à–ö–µ—à</span>
                        </div>
                    </div>
                    <div class="balance-compact" id="balance-display">
                        <span class="balance-value" id="balance-value">0</span>
                        <span class="balance-currency">‚ÇÆ</span>
                    </div>
                </div>
            </header>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="content">
                <!-- –í–∫–ª–∞–¥–∫–∞: –ö–∞—Ä—Ç–∞ -->
                <div id="tab-map" class="tab-content active">
                    <div class="map-container" id="map-container">
                        <div class="map-placeholder" id="map-placeholder">
                            <p>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
                            <p class="map-hint">–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –ø—É–Ω–∫—Ç–æ–≤</p>
                        </div>
                        <div id="map" class="map"></div>
                    </div>
                    <div class="points-list" id="points-list">
                        <!-- –°–ø–∏—Å–æ–∫ –ø—É–Ω–∫—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –ö–∞—Ç–∞–ª–æ–≥ –Ω–∞–≥—Ä–∞–¥ -->
                <div id="tab-catalog" class="tab-content">
                    <div class="catalog-header">
                        <div class="catalog-title-section">
                            <h2>–ö–∞—Ç–∞–ª–æ–≥ –Ω–∞–≥—Ä–∞–¥</h2>
                            <p class="catalog-subtitle">–û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ —Ç—Ä–µ—à–∫–æ–∏–Ω—ã –Ω–∞ –ø–æ–ª–µ–∑–Ω—ã–µ –≤–µ—â–∏</p>
                        </div>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" title="–°–µ—Ç–∫–∞">
                                <span>‚äû</span>
                            </button>
                            <button class="view-btn" data-view="list" title="–°–ø–∏—Å–æ–∫">
                                <span>‚ò∞</span>
                            </button>
                        </div>
                    </div>
                    <div class="rewards-container">
                        <div class="rewards-grid" id="rewards-grid">
                            <!-- –ù–∞–≥—Ä–∞–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –ò—Å—Ç–æ—Ä–∏—è -->
                <div id="tab-history" class="tab-content">
                    <div class="history-header">
                        <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                    </div>
                    <div class="transactions-list" id="transactions-list">
                        <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –ü—Ä–æ—Ñ–∏–ª—å -->
                <div id="tab-profile" class="tab-content">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">üë§</div>
                        <h2 id="profile-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
                        <p id="profile-username" class="profile-username" style="display: none;"></p>
                        <p class="profile-balance">–ë–∞–ª–∞–Ω—Å: <span id="profile-balance-value">0</span> —Ç—Ä–µ—à–∫–æ–∏–Ω–æ–≤</p>
                        <div id="profile-level" class="profile-level">–£—Ä–æ–≤–µ–Ω—å 1</div>
                        <div class="level-progress-bar">
                            <div class="level-progress" id="level-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="profile-stats" id="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">–∫–≥ —Å–¥–∞–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">—Å–¥–∞—á</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">–Ω–∞–≥—Ä–∞–¥</div>
                        </div>
                    </div>
                    <div class="profile-menu">
                        <button class="profile-menu-item" id="btn-scan-qr">
                            <span class="menu-icon">üì∑</span>
                            <span class="menu-text">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</span>
                            <span class="menu-arrow">‚Üí</span>
                        </button>
                        <button class="profile-menu-item" id="btn-upload-receipt">
                            <span class="menu-icon">üìÑ</span>
                            <span class="menu-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫</span>
                            <span class="menu-arrow">‚Üí</span>
                        </button>
                        <a href="/legal/agreement" class="profile-menu-item" target="_blank">
                            <span class="menu-icon">üìã</span>
                            <span class="menu-text">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</span>
                            <span class="menu-arrow">‚Üí</span>
                        </a>
                        <a href="/legal/privacy" class="profile-menu-item" target="_blank">
                            <span class="menu-icon">üîí</span>
                            <span class="menu-text">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                            <span class="menu-arrow">‚Üí</span>
                        </a>
                        <button class="profile-menu-item" id="btn-share-app">
                            <span class="menu-icon">üì§</span>
                            <span class="menu-text">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</span>
                            <span class="menu-arrow">‚Üí</span>
                        </button>
                        <button class="profile-menu-item" id="btn-achievements">
                            <span class="menu-icon">üèÜ</span>
                            <span class="menu-text">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                            <span class="menu-arrow">‚Üí</span>
                        </button>
                    </div>
                </div>
            </main>

            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <button class="nav-item active" data-tab="map">
                    <span class="nav-icon">üó∫Ô∏è</span>
                    <span class="nav-label">–ö–∞—Ä—Ç–∞</span>
                </button>
                <button class="nav-item" data-tab="catalog">
                    <span class="nav-icon">üéÅ</span>
                    <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
                </button>
                <button class="nav-item" data-tab="history">
                    <span class="nav-icon">üìú</span>
                    <span class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
                </button>
                <button class="nav-item" data-tab="profile">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </nav>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR -->
        <div id="modal-qr" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h3>
                    <button class="modal-close" data-modal="modal-qr">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="qr-scanner" class="qr-scanner">
                        <video id="qr-video" autoplay playsinline></video>
                        <canvas id="qr-canvas" class="hidden"></canvas>
                        <div class="qr-overlay">
                            <div class="qr-frame"></div>
                        </div>
                    </div>
                    <p class="qr-hint">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –≤ –ø—É–Ω–∫—Ç–µ –ø—Ä–∏–µ–º–∞</p>
                    <div id="qr-result" class="qr-result hidden"></div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ -->
        <div id="modal-receipt" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞</h3>
                    <button class="modal-close" data-modal="modal-receipt">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="receipt-upload">
                        <input type="file" id="receipt-input" accept="image/*" capture="environment" class="hidden">
                        <button class="btn btn-primary" id="btn-select-receipt">
                            üì∑ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞
                        </button>
                        <div id="receipt-preview" class="receipt-preview hidden"></div>
                        <div class="form-group">
                            <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –ø—Ä–∏–µ–º–∞:</label>
                            <select id="receipt-point-select" class="form-control">
                                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø –º—É—Å–æ—Ä–∞:</label>
                            <select id="receipt-material-select" class="form-control">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                                <option value="–ø–ª–∞—Å—Ç–∏–∫">–ü–ª–∞—Å—Ç–∏–∫</option>
                                <option value="–±—É–º–∞–≥–∞">–ë—É–º–∞–≥–∞</option>
                                <option value="—Å—Ç–µ–∫–ª–æ">–°—Ç–µ–∫–ª–æ</option>
                                <option value="–º–µ—Ç–∞–ª–ª">–ú–µ—Ç–∞–ª–ª</option>
                                <option value="—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–í–µ—Å (–∫–≥):</label>
                            <input type="number" id="receipt-weight" class="form-control" min="0.1" step="0.1" value="1.0">
                        </div>
                        <button class="btn btn-success" id="btn-submit-receipt" disabled>
                            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–∞—á—É
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–µ—Ç–∞–ª–∏ –ø—É–Ω–∫—Ç–∞ -->
        <div id="modal-point" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-point-name">–ü—É–Ω–∫—Ç –ø—Ä–∏–µ–º–∞</h3>
                    <button class="modal-close" data-modal="modal-point">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="modal-point-details"></div>
                    <button class="btn btn-primary btn-block" id="btn-scan-point-qr">
                        üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –ø—É–Ω–∫—Ç–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –£—Å–ø–µ—à–Ω–∞—è —Å–¥–∞—á–∞ -->
        <div id="modal-success" class="modal hidden">
            <div class="modal-content modal-success-content">
                <div class="success-icon">‚úÖ</div>
                <h3>–ú—É—Å–æ—Ä —É—Å–ø–µ—à–Ω–æ —Å–¥–∞–Ω!</h3>
                <p class="success-message" id="success-message"></p>
                <button class="btn btn-primary" data-modal="modal-success">–û—Ç–ª–∏—á–Ω–æ!</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
        <div id="modal-achievements" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                    <button class="modal-close" data-modal="modal-achievements">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="achievements-grid" id="achievements-grid">
                        <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/max-bridge.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>

